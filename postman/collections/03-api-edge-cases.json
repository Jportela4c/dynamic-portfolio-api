{
  "info": {
    "_postman_id": "api-edge-cases-v1",
    "name": "03 - API Edge Cases & Validation",
    "description": "Comprehensive edge case testing including input validation, boundary values, SQL injection, XSS, and error handling",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "01 - Input Validation (Simulation)",
      "item": [
        {
          "name": "Negative Investment Value",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Get fresh token",
                  "pm.sendRequest({",
                  "    url: pm.environment.get('baseUrl') + '/oauth2/token',",
                  "    method: 'POST',",
                  "    header: {",
                  "        'Content-Type': 'application/x-www-form-urlencoded',",
                  "        'Authorization': 'Basic ' + btoa('portfolio-api-client:api-secret')",
                  "    },",
                  "    body: {",
                  "        mode: 'urlencoded',",
                  "        urlencoded: [",
                  "            { key: 'grant_type', value: 'client_credentials' },",
                  "            { key: 'scope', value: 'read write' }",
                  "        ]",
                  "    }",
                  "}, (err, res) => {",
                  "    if (!err && res.code === 200) {",
                  "        pm.environment.set('jwtToken', res.json().access_token);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test(\"Response has error message\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('message');",
                  "    pm.expect(json).to.have.property('status', 400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": -5000,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Zero Investment Value",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 0,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Zero Prazo",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": 0,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Negative Prazo",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": -12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Missing ClienteId",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"valor\": 10000,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Missing TipoProduto",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": 12\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Empty JSON Body",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Malformed JSON",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"clienteId\": 1, \"valor\":"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Invalid TipoProduto Enum",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test(\"Error message mentions invalid value\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.message.toLowerCase()).to.include('invÃ¡lido');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"INVALID_TYPE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "02 - SQL Injection Tests",
      "item": [
        {
          "name": "SQL Injection in TipoProduto",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Request handled safely (400 or 500)\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 500]);",
                  "});",
                  "",
                  "pm.test(\"No database error in response\", () => {",
                  "    const body = pm.response.text();",
                  "    pm.expect(body.toLowerCase()).to.not.include('sql');",
                  "    pm.expect(body.toLowerCase()).to.not.include('database');",
                  "    pm.expect(body.toLowerCase()).to.not.include('syntax');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB' OR '1'='1\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "SQL Injection in ClienteId Path",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Request handled safely\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});",
                  "",
                  "pm.test(\"No SQL error exposed\", () => {",
                  "    const body = pm.response.text();",
                  "    pm.expect(body.toLowerCase()).to.not.include('sql');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1' OR '1'='1",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1' OR '1'='1"]
            }
          },
          "response": []
        },
        {
          "name": "SQL Injection - Union Attack",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Attack prevented\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1 UNION SELECT * FROM users--",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1 UNION SELECT * FROM users--"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "03 - XSS Tests",
      "item": [
        {
          "name": "XSS in TipoProduto",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"XSS payload rejected (400)\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test(\"Response does not contain script tags\", () => {",
                  "    const body = pm.response.text();",
                  "    pm.expect(body).to.not.include('<script>');",
                  "    pm.expect(body).to.not.include('</script>');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"<script>alert('XSS')</script>\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "XSS - Image Tag",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"XSS payload handled\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});",
                  "",
                  "pm.test(\"No image tag in response\", () => {",
                  "    const body = pm.response.text();",
                  "    pm.expect(body).to.not.include('<img');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/<img src=x onerror=alert('XSS')>",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "<img src=x onerror=alert('XSS')>"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "04 - Boundary Values",
      "item": [
        {
          "name": "Extremely Large Value (Overflow Test)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Handles large numbers\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 999999999999999,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Maximum Prazo (120 months)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Accepts maximum term\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 50000,\n  \"prazoMeses\": 120,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        },
        {
          "name": "Decimal Precision Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Handles decimal values\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": 10000.99,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "05 - Error Information Disclosure",
      "item": [
        {
          "name": "500 Error - No Stack Trace",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 500) {",
                  "    pm.test(\"No stack trace in 500 error\", () => {",
                  "        const body = pm.response.text();",
                  "        pm.expect(body).to.not.include('at com.');",
                  "        pm.expect(body).to.not.include('Exception');",
                  "        pm.expect(body).to.not.include('Stack trace');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [{"key": "token", "value": "{{jwtToken}}", "type": "string"}]
            },
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"valor\": null,\n  \"prazoMeses\": 12,\n  \"tipoProduto\": \"CDB\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/simular-investimento",
              "host": ["{{baseUrl}}"],
              "path": ["simular-investimento"]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log('Running edge case test: ' + pm.info.requestName);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "pm.test(\"Response time reasonable (< 3000ms)\", () => {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "pm.test(\"Response has JSON content type (if applicable)\", () => {",
          "    if (pm.response.code !== 401 && pm.response.code !== 415) {",
          "        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "    }",
          "});"
        ]
      }
    }
  ]
}
