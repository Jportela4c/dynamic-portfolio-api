{
  "info": {
    "_postman_id": "oauth2-auth-comprehensive-v1",
    "name": "01 - OAuth2 & Authentication",
    "description": "Comprehensive OAuth2 authentication testing including client credentials, token management, OIDC discovery, and error scenarios",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "01 - Client Credentials Flow",
      "item": [
        {
          "name": "Get Token - Valid (read scope)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has access_token\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('access_token');",
                  "    pm.expect(json.access_token).to.be.a('string');",
                  "    pm.expect(json.access_token.length).to.be.greaterThan(20);",
                  "});",
                  "",
                  "pm.test(\"Response has token_type Bearer\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('token_type');",
                  "    pm.expect(json.token_type).to.equal('Bearer');",
                  "});",
                  "",
                  "pm.test(\"Response has expires_in\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('expires_in');",
                  "    pm.expect(json.expires_in).to.be.a('number');",
                  "    pm.expect(json.expires_in).to.be.greaterThan(0);",
                  "});",
                  "",
                  "pm.test(\"Response has scope matching request\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('scope');",
                  "    pm.expect(json.scope).to.include('read');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const json = pm.response.json();",
                  "    pm.environment.set('jwtToken', json.access_token);",
                  "    pm.environment.set('tokenExpiry', Date.now() + (json.expires_in * 1000));",
                  "    console.log('OAuth2 token (read scope) saved to environment');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Valid (write scope)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has write scope\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.scope).to.include('write');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Valid (read write scope)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has both read and write scopes\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.scope).to.include('read');",
                  "    pm.expect(json.scope).to.include('write');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const json = pm.response.json();",
                  "    pm.environment.set('jwtToken', json.access_token);",
                  "    pm.environment.set('tokenExpiry', Date.now() + (json.expires_in * 1000));",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Invalid Client ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test(\"Response has error\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('error');",
                  "    pm.expect(json.error).to.be.oneOf(['invalid_client', 'unauthorized_client']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "invalid-client-id",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Invalid Client Secret",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test(\"Response has error\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('error');",
                  "    pm.expect(json.error).to.be.oneOf(['invalid_client', 'unauthorized_client']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "wrong-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Missing Credentials",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Invalid Grant Type",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test(\"Response has unsupported_grant_type error\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('error');",
                  "    pm.expect(json.error).to.equal('unsupported_grant_type');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "invalid_grant_type",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Empty Grant Type",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", () => {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        },
        {
          "name": "Get Token - Missing Content-Type",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400 or 415\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 415]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials",
                  "type": "text"
                },
                {
                  "key": "scope",
                  "value": "read write",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/token",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "token"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "02 - OIDC Discovery & JWKS",
      "item": [
        {
          "name": "GET OIDC Discovery",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has issuer\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('issuer');",
                  "    pm.expect(json.issuer).to.be.a('string');",
                  "});",
                  "",
                  "pm.test(\"Response has token_endpoint\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('token_endpoint');",
                  "    pm.expect(json.token_endpoint).to.include('/oauth2/token');",
                  "});",
                  "",
                  "pm.test(\"Response has jwks_uri\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('jwks_uri');",
                  "    pm.expect(json.jwks_uri).to.include('/oauth2/jwks');",
                  "});",
                  "",
                  "pm.test(\"Response has supported grant types\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('grant_types_supported');",
                  "    pm.expect(json.grant_types_supported).to.be.an('array');",
                  "    pm.expect(json.grant_types_supported).to.include('client_credentials');",
                  "});",
                  "",
                  "pm.test(\"Response has supported scopes\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('scopes_supported');",
                  "    pm.expect(json.scopes_supported).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/.well-known/openid-configuration",
              "host": ["{{baseUrl}}"],
              "path": [".well-known", "openid-configuration"]
            }
          },
          "response": []
        },
        {
          "name": "GET JWKS",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has keys array\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('keys');",
                  "    pm.expect(json.keys).to.be.an('array');",
                  "    pm.expect(json.keys.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "pm.test(\"Keys have required properties\", () => {",
                  "    const json = pm.response.json();",
                  "    const firstKey = json.keys[0];",
                  "    pm.expect(firstKey).to.have.property('kty');",
                  "    pm.expect(firstKey).to.have.property('kid');",
                  "    pm.expect(firstKey).to.have.property('alg');",
                  "    pm.expect(firstKey).to.have.property('use');",
                  "});",
                  "",
                  "pm.test(\"Keys use RS256 algorithm\", () => {",
                  "    const json = pm.response.json();",
                  "    json.keys.forEach(key => {",
                  "        pm.expect(key.alg).to.equal('RS256');",
                  "    });",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const json = pm.response.json();",
                  "    pm.environment.set('jwksKeys', JSON.stringify(json.keys));",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/oauth2/jwks",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "jwks"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "03 - Token Introspection",
      "item": [
        {
          "name": "Introspect Active Token",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Ensure we have a valid token",
                  "const tokenExpiry = pm.environment.get('tokenExpiry');",
                  "const now = Date.now();",
                  "",
                  "if (!tokenExpiry || now > tokenExpiry - 60000) {",
                  "    pm.sendRequest({",
                  "        url: pm.environment.get('baseUrl') + '/oauth2/token',",
                  "        method: 'POST',",
                  "        header: {",
                  "            'Content-Type': 'application/x-www-form-urlencoded',",
                  "            'Authorization': 'Basic ' + btoa('portfolio-api-client:api-secret')",
                  "        },",
                  "        body: {",
                  "            mode: 'urlencoded',",
                  "            urlencoded: [",
                  "                { key: 'grant_type', value: 'client_credentials' },",
                  "                { key: 'scope', value: 'read write' }",
                  "            ]",
                  "        }",
                  "    }, (err, res) => {",
                  "        if (!err && res.code === 200) {",
                  "            const json = res.json();",
                  "            pm.environment.set('jwtToken', json.access_token);",
                  "            pm.environment.set('tokenExpiry', Date.now() + (json.expires_in * 1000));",
                  "        }",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Token is active\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('active');",
                  "    pm.expect(json.active).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"Response has token metadata\", () => {",
                  "    const json = pm.response.json();",
                  "    if (json.active) {",
                  "        pm.expect(json).to.have.property('scope');",
                  "        pm.expect(json).to.have.property('client_id');",
                  "        pm.expect(json).to.have.property('exp');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "value": "{{jwtToken}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/introspect",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "introspect"]
            }
          },
          "response": []
        },
        {
          "name": "Introspect Invalid Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Token is inactive\", () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('active');",
                  "    pm.expect(json.active).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "basic",
              "basic": [
                {
                  "key": "username",
                  "value": "portfolio-api-client",
                  "type": "string"
                },
                {
                  "key": "password",
                  "value": "api-secret",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "value": "invalid.token.here",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/oauth2/introspect",
              "host": ["{{baseUrl}}"],
              "path": ["oauth2", "introspect"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "04 - Protected Endpoint Access",
      "item": [
        {
          "name": "Access Endpoint - Without Token (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1"]
            }
          },
          "response": []
        },
        {
          "name": "Access Endpoint - With Valid Token (200)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Get fresh token",
                  "pm.sendRequest({",
                  "    url: pm.environment.get('baseUrl') + '/oauth2/token',",
                  "    method: 'POST',",
                  "    header: {",
                  "        'Content-Type': 'application/x-www-form-urlencoded',",
                  "        'Authorization': 'Basic ' + btoa('portfolio-api-client:api-secret')",
                  "    },",
                  "    body: {",
                  "        mode: 'urlencoded',",
                  "        urlencoded: [",
                  "            { key: 'grant_type', value: 'client_credentials' },",
                  "            { key: 'scope', value: 'read write' }",
                  "        ]",
                  "    }",
                  "}, (err, res) => {",
                  "    if (!err && res.code === 200) {",
                  "        const json = res.json();",
                  "        pm.environment.set('jwtToken', json.access_token);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 404\", () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwtToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1"]
            }
          },
          "response": []
        },
        {
          "name": "Access Endpoint - With Invalid Token (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "invalid.jwt.token",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1"]
            }
          },
          "response": []
        },
        {
          "name": "Access Endpoint - Malformed Authorization Header (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", () => {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "InvalidFormat token123",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/perfil-risco/1",
              "host": ["{{baseUrl}}"],
              "path": ["perfil-risco", "1"]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('Running OAuth2 test: ' + pm.info.requestName);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test(\"Response time is reasonable (< 3000ms)\", () => {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "pm.test(\"Response has correct content type\", () => {",
          "    if (pm.response.code !== 401 && pm.response.code !== 403) {",
          "        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "    }",
          "});"
        ]
      }
    }
  ]
}
